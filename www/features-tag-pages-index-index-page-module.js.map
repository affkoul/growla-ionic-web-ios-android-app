{"version":3,"sources":["./src/core/features/tag/pages/index/index.html","./src/core/features/tag/pages/index/index.page.module.ts","./src/core/features/tag/pages/index/index.page.ts"],"names":[],"mappings":"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","file":"features-tag-pages-index-index-page-module.js","sourcesContent":["export default \"<ion-header>\\n    <ion-toolbar>\\n        <ion-buttons slot=\\\"start\\\">\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\n        </ion-buttons>\\n        <h1>{{ 'core.tag.tag' | translate }}: {{ tagName }}</h1>\\n    </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n    <core-split-view>\\n        <ion-refresher slot=\\\"fixed\\\" [disabled]=\\\"!loaded\\\" (ionRefresh)=\\\"refreshData($event.target)\\\">\\n            <ion-refresher-content pullingText=\\\"{{ 'core.pulltorefresh' | translate }}\\\"></ion-refresher-content>\\n        </ion-refresher>\\n        <core-loading [hideUntil]=\\\"loaded\\\">\\n            <ion-list *ngIf=\\\"hasUnsupportedAreas || areas.length\\\">\\n                <ion-item *ngIf=\\\"hasUnsupportedAreas\\\" class=\\\"core-warning-item\\\">\\n                    <ion-icon slot=\\\"start\\\" name=\\\"fas-exclamation-triangle\\\" color=\\\"warning\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n                    <ion-label class=\\\"ion-text-wrap\\\">{{ 'core.tag.warningareasnotsupported' | translate }}</ion-label>\\n                </ion-item>\\n                <ion-item class=\\\"ion-text-wrap\\\" *ngFor=\\\"let area of areas\\\" [attr.aria-label]=\\\"area.nameKey | translate\\\"\\n                    (click)=\\\"openArea(area)\\\" [attr.aria-current]=\\\"area!.id == selectedAreaId ? 'page' : 'false'\\\" button\\n                    detail=\\\"true\\\">\\n                    <ion-label>\\n                        <h2>{{ area!.nameKey | translate }}</h2>\\n                    </ion-label>\\n                    <ion-badge slot=\\\"end\\\" *ngIf=\\\"area!.badge\\\">\\n                        <span aria-hidden=\\\"true\\\">{{ area!.badge }}</span>\\n                        <span class=\\\"sr-only\\\">{{ 'core.tag.tagareabadgedescription' | translate:{ count: area!.badge } }}</span>\\n                    </ion-badge>\\n                </ion-item>\\n            </ion-list>\\n            <core-empty-box icon=\\\"fas-tag\\\" *ngIf=\\\"!hasUnsupportedAreas && (!areas || !areas.length)\\\"\\n                [message]=\\\"'core.tag.noresultsfor' | translate: { $a: tagName }\\\"></core-empty-box>\\n        </core-loading>\\n    </core-split-view>\\n</ion-content>\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { conditionalRoutes } from '@/app/app-routing.module';\nimport { CoreTagIndexAreaRoute } from '@features/tag/tag-lazy.module';\nimport { CoreScreen } from '@services/screen';\n\nimport { CoreSharedModule } from '@/core/shared.module';\nimport { CoreTagIndexPage } from './index.page';\n\nconst mobileRoutes: Routes = [\n    {\n        path: '',\n        component: CoreTagIndexPage,\n    },\n    CoreTagIndexAreaRoute,\n];\n\nconst tabletRoutes: Routes = [\n    {\n        path: '',\n        component: CoreTagIndexPage,\n        children: [\n            CoreTagIndexAreaRoute,\n        ],\n    },\n];\n\nconst routes: Routes = [\n    ...conditionalRoutes(mobileRoutes, () => CoreScreen.isMobile),\n    ...conditionalRoutes(tabletRoutes, () => CoreScreen.isTablet),\n];\n\n@NgModule({\n    declarations: [\n        CoreTagIndexPage,\n    ],\n    imports: [\n        RouterModule.forChild(routes),\n        CoreSharedModule,\n    ],\n    exports: [RouterModule],\n})\nexport class CoreTagIndexPageModule {}\n","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnInit } from '@angular/core';\nimport { IonRefresher } from '@ionic/angular';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreTag } from '@features/tag/services/tag';\nimport { CoreTagAreaDelegate } from '@features/tag/services/tag-area-delegate';\nimport { CoreScreen } from '@services/screen';\nimport { CoreNavigator } from '@services/navigator';\n\n/**\n * Page that displays the tag index.\n */\n@Component({\n    selector: 'page-core-tag-index',\n    templateUrl: 'index.html',\n})\nexport class CoreTagIndexPage implements OnInit {\n\n    tagId = 0;\n    tagName = '';\n    collectionId = 0;\n    areaId = 0;\n    fromContextId = 0;\n    contextId = 0;\n    recursive = true;\n    loaded = false;\n    selectedAreaId?: number;\n    hasUnsupportedAreas = false;\n\n    areas: CoreTagAreaDisplay[] = [];\n\n    /**\n     * View loaded.\n     */\n    async ngOnInit(): Promise<void> {\n        this.tagId = CoreNavigator.getRouteNumberParam('tagId') || this.tagId;\n        this.tagName = CoreNavigator.getRouteParam('tagName') || this.tagName;\n        this.collectionId = CoreNavigator.getRouteNumberParam('collectionId') || this.collectionId;\n        this.areaId = CoreNavigator.getRouteNumberParam('areaId') || this.areaId;\n        this.fromContextId = CoreNavigator.getRouteNumberParam('fromContextId') || this.fromContextId;\n        this.contextId = CoreNavigator.getRouteNumberParam('contextId') || this.contextId;\n        this.recursive = CoreNavigator.getRouteBooleanParam('recursive') ?? true;\n\n        try {\n            await this.fetchData();\n            if (CoreScreen.isTablet && this.areas && this.areas.length > 0) {\n                const area = this.areas.find((area) => area.id == this.areaId);\n                this.openArea(area || this.areas[0]);\n            }\n        } finally {\n            this.loaded = true;\n        }\n    }\n\n    /**\n     * Fetch first page of tag index per area.\n     *\n     * @return Resolved when done.\n     */\n    async fetchData(): Promise<void> {\n        try {\n            const areas = await CoreTag.getTagIndexPerArea(\n                this.tagId,\n                this.tagName,\n                this.collectionId,\n                this.areaId,\n                this.fromContextId,\n                this.contextId,\n                this.recursive,\n                0,\n            );\n\n            this.areas = [];\n            this.hasUnsupportedAreas = false;\n\n            const areasDisplay: CoreTagAreaDisplay[] = [];\n\n            await Promise.all(areas.map(async (area) => {\n                const items = await CoreTagAreaDelegate.parseContent(area.component, area.itemtype, area.content);\n\n                if (!items || !items.length) {\n                    // Tag area not supported, skip.\n                    this.hasUnsupportedAreas = true;\n\n                    return;\n                }\n\n                areasDisplay.push({\n                    id: area.ta,\n                    componentName: area.component,\n                    itemType: area.itemtype,\n                    nameKey: CoreTagAreaDelegate.getDisplayNameKey(area.component, area.itemtype),\n                    items,\n                    canLoadMore: !!area.nextpageurl,\n                    badge: items && items.length ? items.length + (area.nextpageurl ? '+' : '') : '',\n                });\n            }));\n\n            this.areas = areasDisplay;\n\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading tag index');\n        }\n    }\n\n    /**\n     * Refresh data.\n     *\n     * @param refresher Refresher.\n     */\n    refreshData(refresher?: IonRefresher): void {\n        CoreTag.invalidateTagIndexPerArea(\n            this.tagId,\n            this.tagName,\n            this.collectionId,\n            this.areaId,\n            this.fromContextId,\n            this.contextId,\n            this.recursive,\n        ).finally(() => {\n            this.fetchData().finally(() => {\n                refresher?.complete();\n            });\n        });\n    }\n\n    /**\n     * Navigate to an index area.\n     *\n     * @param area Area.\n     */\n    openArea(area: CoreTagAreaDisplay): void {\n        this.selectedAreaId = area.id;\n\n        const params = {\n            tagId: this.tagId,\n            tagName: this.tagName,\n            collectionId: this.collectionId,\n            areaId: area.id,\n            fromContextId: this.fromContextId,\n            contextId: this.contextId,\n            recursive: this.recursive,\n            areaNameKey: area.nameKey,\n            componentName: area.componentName,\n            itemType: area.itemType,\n            items: area.items.slice(),\n            canLoadMore: area.canLoadMore,\n            nextPage: 1,\n        };\n\n        const splitViewLoaded = CoreNavigator.isCurrentPathInTablet('**/tag/index/index-area');\n        const path = (splitViewLoaded ? '../' : '') + 'index-area';\n\n        CoreNavigator.navigate(path, { params });\n    }\n\n}\n\nexport type CoreTagAreaDisplay = {\n    id: number;\n    componentName: string;\n    itemType: string;\n    nameKey: string;\n    items: unknown[];\n    canLoadMore: boolean;\n    badge: string;\n};\n"],"sourceRoot":"webpack:///"}