{"version":3,"sources":["./src/core/features/login/pages/reconnect/reconnect.html","./src/core/features/login/pages/reconnect/reconnect.module.ts","./src/core/features/login/pages/reconnect/reconnect.ts"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAe,mQAAoM,sCAAsC,uNAAuN,qCAAqC,0LAA0L,+BAA+B,iBAAiB,GAAG,0oBAA0oB,SAAS,4RAA4R,iDAAiD,+TAA+T,UAAU,gJAAgJ,qCAAqC,uMAAuM,qCAAqC,icAAic,mCAAmC,wNAAwN,wCAAwC,sNAAsN,+BAA+B,2QAA2Q,6BAA6B,kaAAka,sCAAsC,oTAAoT,0CAA0C,yWAAyW,eAAe,2RAA2R,mCAAmC,2DAA2D,E;;;;;;;;;;;;ACApsK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAqC;AACrC,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,iDAAiD;AACjD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEQ;AACc;AAEC;AACH;AAErD,MAAM,MAAM,GAAW;IACnB;QACI,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,iEAAsB;KACpC;CACJ,CAAC;IAYW,4BAA4B,SAA5B,4BAA4B;CAAG;AAA/B,4BAA4B;IAVxC,8DAAQ,CAAC;QACN,OAAO,EAAE;YACL,4DAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC7B,oEAAgB;SACnB;QACD,YAAY,EAAE;YACV,iEAAsB;SACzB;QACD,OAAO,EAAE,CAAC,4DAAY,CAAC;KAC1B,CAAC;GACW,4BAA4B,CAAG;AAAH;;;;;;;;;;;;;ACrCzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAqC;AACrC,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,iDAAiD;AACjD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEmD;AAChB;AAE5B;AACI;AACO;AACD;AACsB;AAExB;AACE;AACyB;AAC9B;AAE7C;;GAEG;IAMU,sBAAsB,SAAtB,sBAAsB;IAyB/B,YACc,EAAe;QAAf,OAAE,GAAF,EAAE,CAAa;QAd7B,0BAAqB,GAAG,IAAI,CAAC;QAC7B,mBAAc,GAAG,KAAK,CAAC;QACvB,YAAO,GAAG,KAAK,CAAC;QAGhB,eAAU,GAAG,KAAK,CAAC;QAKT,aAAQ,GAAG,KAAK,CAAC;QACjB,gBAAW,GAAG,KAAK,CAAC;QAK1B,MAAM,WAAW,GAAG,yDAAS,CAAC,cAAc,EAAE,CAAC;QAE/C,IAAI,CAAC,WAAW,GAAG,CAAC,EAAC,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,WAAW,GAAE,CAAC;QAChD,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,KAAK,CAAC;YACrB,QAAQ,EAAE,CAAC,EAAE,EAAE,yDAAU,CAAC,QAAQ,CAAC;SACtC,CAAC,CAAC;IACP,CAAC;IAED;;OAEG;IACG,QAAQ;;YACV,MAAM,MAAM,GAAG,kEAAa,CAAC,aAAa,CAAS,QAAQ,CAAC,CAAC;YAC7D,IAAI,CAAC,MAAM,EAAE;gBACT,OAAO,IAAI,CAAC,MAAM,EAAE,CAAC;aACxB;YAED,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YACrB,IAAI,CAAC,IAAI,GAAG,kEAAa,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;YACpD,IAAI,CAAC,WAAW,GAAG,kEAAa,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;YAC9D,IAAI,CAAC,UAAU,GAAG,qFAAe,CAAC,qBAAqB,EAAE,IAAI,qFAAe,CAAC,4BAA4B,EAAE,CAAC;YAE5G,IAAI;gBACA,MAAM,IAAI,GAAG,MAAM,yDAAS,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAElD,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;oBACb,MAAM,IAAI,+DAAS,CAAC,cAAc,CAAC,CAAC;iBACvC;gBAED,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;gBACpC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;gBACxC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;gBAC5C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;gBAClC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;gBAEnC,wFAAwF;gBACxF,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;gBAE9B,oDAAoD;gBACpD,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,qFAAe,CAAC,aAAa,EAAE,CAAC;gBAE5E,MAAM,MAAM,GAAG,MAAM,+DAAS,CAAC,YAAY,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC;gBAEpE,IAAI,CAAC,MAAM,EAAE;oBACT,OAAO;iBACV;gBAED,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC;gBAEzB,MAAM,yDAAS,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;gBAEzC,2CAA2C;gBAC3C,IAAI,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,GAAG,kBAAkB,CAAC,EAAE;oBAC/D,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;iBAC/B;gBACD,IAAI,CAAC,OAAO,GAAG,qFAAe,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;gBAElD,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;aAC3C;YAAC,OAAO,KAAK,EAAE;gBACZ,uBAAuB;gBACvB,IAAI,CAAC,MAAM,EAAE,CAAC;aACjB;QACL,CAAC;KAAA;IAED;;OAEG;IACH,WAAW;QACP,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,6DAAU,CAAC,OAAO,CAAC,6DAAU,CAAC,oBAAoB,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;IAClG,CAAC;IAED;;;;OAIG;IACO,iBAAiB,CAAC,MAAoC;QAC5D,MAAM,gBAAgB,GAAG,qFAAe,CAAC,mBAAmB,CAAC,MAAM,CAAC,CAAC;QAErE,IAAI,CAAC,iBAAiB,GAAG,qFAAe,CAAC,yBAAyB,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;QAC7F,IAAI,CAAC,qBAAqB,GAAG,CAAC,qFAAe,CAAC,2BAA2B,CAAC,MAAM,CAAC,CAAC;QAElF,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YACrC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YACxB,6DAAU,CAAC,OAAO,CAAC,6DAAU,CAAC,kBAAkB,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC;SACzE;IACL,CAAC;IAED;;;;OAIG;IACH,MAAM,CAAC,CAAS;QACZ,IAAI,CAAC,EAAE;YACH,CAAC,CAAC,cAAc,EAAE,CAAC;YACnB,CAAC,CAAC,eAAe,EAAE,CAAC;SACvB;QAED,yDAAS,CAAC,MAAM,EAAE,CAAC;IACvB,CAAC;IAED;;;;OAIG;IACG,KAAK,CAAC,CAAQ;;YAChB,CAAC,CAAC,cAAc,EAAE,CAAC;YACnB,CAAC,CAAC,eAAe,EAAE,CAAC;YAEpB,qDAAO,CAAC,aAAa,EAAE,CAAC;YAExB,kBAAkB;YAClB,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC;YAE9C,IAAI,CAAC,QAAQ,EAAE;gBACX,gEAAY,CAAC,cAAc,CAAC,6BAA6B,EAAE,IAAI,CAAC,CAAC;gBAEjE,OAAO;aACV;YAED,IAAI,CAAC,qDAAO,CAAC,QAAQ,EAAE,EAAE;gBACrB,gEAAY,CAAC,cAAc,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;gBAE1D,OAAO;aACV;YAED,MAAM,KAAK,GAAG,MAAM,gEAAY,CAAC,gBAAgB,EAAE,CAAC;YAEpD,IAAI;gBACA,oCAAoC;gBACpC,MAAM,IAAI,GAAG,MAAM,yDAAS,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;gBAEjF,MAAM,yDAAS,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;gBAE5F,2DAAS,CAAC,yBAAyB,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;gBAE5D,wBAAwB;gBACxB,MAAM,yDAAS,CAAC,mBAAmB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAEjE,uDAAuD;gBACvD,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,KAAK,EAAE,CAAC;gBAE3C,+BAA+B;gBAC/B,IAAI,CAAC,IAAI;oBACL,CAAC,CAAC,MAAM,kEAAa,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC;oBACjF,CAAC,CAAC,MAAM,kEAAa,CAAC,kBAAkB,EAAE,CAAC;aAClD;YAAC,OAAO,KAAK,EAAE;gBACZ,qFAAe,CAAC,mBAAmB,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;gBAElF,IAAI,KAAK,CAAC,SAAS,EAAE;oBACjB,IAAI,CAAC,MAAM,EAAE,CAAC;iBACjB;qBAAM,IAAI,KAAK,CAAC,SAAS,IAAI,2BAA2B,EAAE;oBACvD,wBAAwB;oBACxB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;iBAC3C;aACJ;oBAAS;gBACN,KAAK,CAAC,OAAO,EAAE,CAAC;aACnB;QACL,CAAC;KAAA;IAED;;OAEG;IACH,iBAAiB;QACb,qFAAe,CAAC,wBAAwB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IAC3F,CAAC;IAED;;;;OAIG;IACH,YAAY,CAAC,QAAkC;;QAC3C,MAAM,MAAM,GAAG,qFAAe,CAAC,wBAAwB,CACnD,IAAI,CAAC,OAAO,EACZ,QAAQ,QACR,IAAI,CAAC,UAAU,0CAAE,SAAS,EAC1B,IAAI,CAAC,IAAI,EACT,IAAI,CAAC,WAAW,CACnB,CAAC;QAEF,IAAI,CAAC,MAAM,EAAE;YACT,gEAAY,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;SAChD;IACL,CAAC;IAED;;;;OAIG;IACG,yBAAyB;;YAC3B,IAAI;gBACA,MAAM,qFAAe,CAAC,sBAAsB,EAAE,CAAC;gBAE/C,MAAM,qFAAe,CAAC,MAAM,EAAE,CAAC;aAClC;YAAC,WAAM;gBACJ,iBAAiB;aACpB;QACL,CAAC;KAAA;IAED;;;;OAIG;IACH,OAAO,CAAC,CAAgB;QACpB,IAAI,CAAC,CAAC,GAAG,IAAI,QAAQ,EAAE;YACnB,CAAC,CAAC,cAAc,EAAE,CAAC;YACnB,CAAC,CAAC,eAAe,EAAE,CAAC;SACvB;IACL,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,CAAgB;QAClB,IAAI,CAAC,CAAC,GAAG,IAAI,QAAQ,EAAE;YACnB,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;SAClB;IACL,CAAC;CAEJ;;YApRQ,0DAAW;;;0BAuBf,uDAAS,SAAC,eAAe;;AAFjB,sBAAsB;IALlC,+DAAS,CAAC;QACP,QAAQ,EAAE,2BAA2B;QACrC,yOAA6B;;KAEhC,CAAC;GACW,sBAAsB,CA+PlC;AA/PkC","file":"pages-reconnect-reconnect-module.js","sourcesContent":["export default \"<ion-header>\\n    <ion-toolbar>\\n        <ion-buttons slot=\\\"start\\\">\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\n        </ion-buttons>\\n\\n        <h1>{{ 'core.login.reconnect' | translate }}</h1>\\n    </ion-toolbar>\\n</ion-header>\\n<ion-content class=\\\"ion-padding\\\" (keydown)=\\\"keyDown($event)\\\" (keyup)=\\\"keyUp($event)\\\">\\n    <div class=\\\"ion-text-wrap ion-text-center ion-margin-bottom\\\" [ngClass]=\\\"{'item-avatar-center': showSiteAvatar}\\\">\\n        <!-- Show user avatar. -->\\n        <img *ngIf=\\\"showSiteAvatar\\\" [src]=\\\"userAvatar\\\" class=\\\"large-avatar\\\" core-external-content [siteId]=\\\"siteId\\\"\\n            alt=\\\"{{ 'core.pictureof' | translate:{$a: userFullName} }}\\\" onError=\\\"this.src='assets/img/user-avatar.png'\\\">\\n\\n        <div class=\\\"core-login-site-logo\\\" *ngIf=\\\"!showSiteAvatar\\\">\\n            <!-- Show site logo or a default image. -->\\n            <img *ngIf=\\\"logoUrl\\\" [src]=\\\"logoUrl\\\" role=\\\"presentation\\\" onError=\\\"this.src='assets/img/login_logo.png'\\\" alt=\\\"\\\">\\n            <img *ngIf=\\\"!logoUrl\\\" src=\\\"assets/img/login_logo.png\\\" role=\\\"presentation\\\" alt=\\\"\\\">\\n        </div>\\n\\n        <p *ngIf=\\\"siteName\\\" class=\\\"ion-padding core-sitename\\\">\\n            <core-format-text [text]=\\\"siteName\\\" [filter]=\\\"false\\\"></core-format-text>\\n        </p>\\n        <p class=\\\"core-siteurl\\\">{{siteUrl}}</p>\\n\\n        <ion-card *ngIf=\\\"!isLoggedOut\\\" class=\\\"core-danger-card core-login-reconnect-warning\\\">\\n            <ion-item>\\n                <ion-icon name=\\\"fas-exclamation-circle\\\" slot=\\\"start\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n                <ion-label color=\\\"danger\\\">{{ 'core.login.reconnectdescription' | translate }}</ion-label>\\n            </ion-item>\\n        </ion-card>\\n    </div>\\n    <form *ngIf=\\\"!isOAuth\\\" [formGroup]=\\\"credForm\\\" (ngSubmit)=\\\"login($event)\\\" class=\\\"core-login-form\\\" #reconnectForm>\\n        <ion-item class=\\\"ion-text-wrap core-username item-interactive\\\">\\n            <ion-label>\\n                <p>{{username}}</p>\\n            </ion-label>\\n        </ion-item>\\n        <ion-item class=\\\"ion-margin-bottom\\\">\\n            <ion-label class=\\\"sr-only\\\">{{ 'core.login.password' | translate }}</ion-label>\\n            <core-show-password name=\\\"password\\\">\\n                <ion-input class=\\\"core-ioninput-password\\\" name=\\\"password\\\" type=\\\"password\\\"\\n                    placeholder=\\\"{{ 'core.login.password' | translate }}\\\" formControlName=\\\"password\\\" [clearOnEdit]=\\\"false\\\"\\n                    autocomplete=\\\"current-password\\\" enterkeyhint=\\\"go\\\" required=\\\"true\\\">\\n                </ion-input>\\n            </core-show-password>\\n        </ion-item>\\n        <ion-grid class=\\\"ion-padding\\\">\\n            <ion-row>\\n                <ion-col>\\n                    <ion-button expand=\\\"block\\\" color=\\\"light\\\" (click)=\\\"cancel($event)\\\">\\n                        {{ 'core.login.cancel' | translate }}\\n                    </ion-button>\\n                </ion-col>\\n                <ion-col>\\n                    <ion-button type=\\\"submit\\\" expand=\\\"block\\\" [disabled]=\\\"!credForm.valid\\\">\\n                        {{ 'core.login.loginbutton' | translate }}\\n                    </ion-button>\\n                </ion-col>\\n            </ion-row>\\n        </ion-grid>\\n\\n        <ng-container *ngIf=\\\"showScanQR\\\">\\n            <div class=\\\"ion-text-center ion-padding\\\">{{ 'core.login.or' | translate }}</div>\\n            <ion-button expand=\\\"block\\\" color=\\\"light\\\" class=\\\"ion-margin\\\" lines=\\\"none\\\" (click)=\\\"showInstructionsAndScanQR()\\\">\\n                <ion-icon slot=\\\"start\\\" name=\\\"fas-qrcode\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n                <ion-label>{{ 'core.scanqr' | translate }}</ion-label>\\n            </ion-button>\\n        </ng-container>\\n    </form>\\n\\n    <!-- Forgotten password option. -->\\n    <ion-button\\n        *ngIf=\\\"showForgottenPassword && !isOAuth\\\"\\n        expand=\\\"block\\\"\\n        fill=\\\"clear\\\"\\n        color=\\\"dark\\\"\\n        class=\\\"core-login-forgotten-password core-button-as-link ion-text-wrap\\\"\\n        (click)=\\\"forgottenPassword()\\\"\\n    >\\n        <ion-label>{{ 'core.login.forgotten' | translate }}</ion-label>\\n    </ion-button>\\n\\n    <!-- Identity providers. -->\\n    <ion-list *ngIf=\\\"identityProviders && identityProviders.length\\\" class=\\\"ion-padding-top core-login-identity-providers\\\">\\n        <ion-item class=\\\"ion-text-wrap\\\" lines=\\\"none\\\">\\n            <ion-label><h3 class=\\\"item-heading\\\">{{ 'core.login.potentialidps' | translate }}</h3></ion-label>\\n        </ion-item>\\n        <ion-item button *ngFor=\\\"let provider of identityProviders\\\" class=\\\"ion-text-wrap core-oauth-icon\\\"\\n            (click)=\\\"oauthClicked(provider)\\\" detail=\\\"false\\\">\\n            <img [src]=\\\"provider.iconurl\\\" alt=\\\"\\\" role=\\\"presentation\\\" width=\\\"32\\\" height=\\\"32\\\" slot=\\\"start\\\">\\n            <ion-label>{{provider.name}}</ion-label>\\n        </ion-item>\\n    </ion-list>\\n\\n    <!-- If OAuth, display cancel button since the form isn't displayed. -->\\n    <ion-list *ngIf=\\\"isOAuth\\\">\\n        <ion-button expand=\\\"block\\\" class=\\\"ion-margin\\\" color=\\\"light\\\" (click)=\\\"cancel($event)\\\">\\n            {{ 'core.login.cancel' | translate }}\\n        </ion-button>\\n    </ion-list>\\n</ion-content>\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { CoreSharedModule } from '@/core/shared.module';\nimport { CoreLoginReconnectPage } from './reconnect';\n\nconst routes: Routes = [\n    {\n        path: '',\n        component: CoreLoginReconnectPage,\n    },\n];\n\n@NgModule({\n    imports: [\n        RouterModule.forChild(routes),\n        CoreSharedModule,\n    ],\n    declarations: [\n        CoreLoginReconnectPage,\n    ],\n    exports: [RouterModule],\n})\nexport class CoreLoginReconnectPageModule {}\n","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnInit, OnDestroy, ViewChild, ElementRef } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\n\nimport { CoreApp } from '@services/app';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUtils } from '@services/utils/utils';\nimport { CoreLoginHelper } from '@features/login/services/login-helper';\nimport { CoreSiteIdentityProvider, CoreSitePublicConfigResponse } from '@classes/site';\nimport { CoreEvents } from '@singletons/events';\nimport { CoreError } from '@classes/errors/error';\nimport { CoreNavigationOptions, CoreNavigator } from '@services/navigator';\nimport { CoreForms } from '@singletons/form';\n\n/**\n * Page to enter the user password to reconnect to a site.\n */\n@Component({\n    selector: 'page-core-login-reconnect',\n    templateUrl: 'reconnect.html',\n    styleUrls: ['../../login.scss'],\n})\nexport class CoreLoginReconnectPage implements OnInit, OnDestroy {\n\n    @ViewChild('reconnectForm') formElement?: ElementRef;\n\n    credForm: FormGroup;\n    siteUrl!: string;\n    username!: string;\n    userFullName!: string;\n    userAvatar?: string;\n    siteName!: string;\n    logoUrl?: string;\n    identityProviders?: CoreSiteIdentityProvider[];\n    showForgottenPassword = true;\n    showSiteAvatar = false;\n    isOAuth = false;\n    isLoggedOut: boolean;\n    siteId!: string;\n    showScanQR = false;\n\n    protected page?: string;\n    protected pageOptions?: CoreNavigationOptions;\n    protected siteConfig?: CoreSitePublicConfigResponse;\n    protected viewLeft = false;\n    protected eventThrown = false;\n\n    constructor(\n        protected fb: FormBuilder,\n    ) {\n        const currentSite = CoreSites.getCurrentSite();\n\n        this.isLoggedOut = !!currentSite?.isLoggedOut();\n        this.credForm = fb.group({\n            password: ['', Validators.required],\n        });\n    }\n\n    /**\n     * Initialize the component.\n     */\n    async ngOnInit(): Promise<void> {\n        const siteId = CoreNavigator.getRouteParam<string>('siteId');\n        if (!siteId) {\n            return this.cancel();\n        }\n\n        this.siteId = siteId;\n        this.page = CoreNavigator.getRouteParam('pageName');\n        this.pageOptions = CoreNavigator.getRouteParam('pageOptions');\n        this.showScanQR = CoreLoginHelper.displayQRInSiteScreen() || CoreLoginHelper.displayQRInCredentialsScreen();\n\n        try {\n            const site = await CoreSites.getSite(this.siteId);\n\n            if (!site.infos) {\n                throw new CoreError('Invalid site');\n            }\n\n            this.username = site.infos.username;\n            this.userFullName = site.infos.fullname;\n            this.userAvatar = site.infos.userpictureurl;\n            this.siteUrl = site.infos.siteurl;\n            this.siteName = site.getSiteName();\n\n            // If login was OAuth we should only reach this page if the OAuth method ID has changed.\n            this.isOAuth = site.isOAuth();\n\n            // Show logo instead of avatar if it's a fixed site.\n            this.showSiteAvatar = !!this.userAvatar && !CoreLoginHelper.getFixedSites();\n\n            const config = await CoreUtils.ignoreErrors(site.getPublicConfig());\n\n            if (!config) {\n                return;\n            }\n\n            this.siteConfig = config;\n\n            await CoreSites.checkApplication(config);\n\n            // Check logoURL if user avatar is not set.\n            if (this.userAvatar.startsWith(this.siteUrl + '/theme/image.php')) {\n                this.showSiteAvatar = false;\n            }\n            this.logoUrl = CoreLoginHelper.getLogoUrl(config);\n\n            this.getDataFromConfig(this.siteConfig);\n        } catch (error) {\n            // Just leave the view.\n            this.cancel();\n        }\n    }\n\n    /**\n     * Component destroyed.\n     */\n    ngOnDestroy(): void {\n        this.viewLeft = true;\n        CoreEvents.trigger(CoreEvents.LOGIN_SITE_UNCHECKED, { config: this.siteConfig }, this.siteId);\n    }\n\n    /**\n     * Get some data (like identity providers) from the site config.\n     *\n     * @param config Config to use.\n     */\n    protected getDataFromConfig(config: CoreSitePublicConfigResponse): void {\n        const disabledFeatures = CoreLoginHelper.getDisabledFeatures(config);\n\n        this.identityProviders = CoreLoginHelper.getValidIdentityProviders(config, disabledFeatures);\n        this.showForgottenPassword = !CoreLoginHelper.isForgottenPasswordDisabled(config);\n\n        if (!this.eventThrown && !this.viewLeft) {\n            this.eventThrown = true;\n            CoreEvents.trigger(CoreEvents.LOGIN_SITE_CHECKED, { config: config });\n        }\n    }\n\n    /**\n     * Cancel reconnect.\n     *\n     * @param e Event.\n     */\n    cancel(e?: Event): void {\n        if (e) {\n            e.preventDefault();\n            e.stopPropagation();\n        }\n\n        CoreSites.logout();\n    }\n\n    /**\n     * Tries to authenticate the user.\n     *\n     * @param e Event.\n     */\n    async login(e: Event): Promise<void> {\n        e.preventDefault();\n        e.stopPropagation();\n\n        CoreApp.closeKeyboard();\n\n        // Get input data.\n        const password = this.credForm.value.password;\n\n        if (!password) {\n            CoreDomUtils.showErrorModal('core.login.passwordrequired', true);\n\n            return;\n        }\n\n        if (!CoreApp.isOnline()) {\n            CoreDomUtils.showErrorModal('core.networkerrormsg', true);\n\n            return;\n        }\n\n        const modal = await CoreDomUtils.showModalLoading();\n\n        try {\n            // Start the authentication process.\n            const data = await CoreSites.getUserToken(this.siteUrl, this.username, password);\n\n            await CoreSites.updateSiteToken(this.siteUrl, this.username, data.token, data.privateToken);\n\n            CoreForms.triggerFormSubmittedEvent(this.formElement, true);\n\n            // Update site info too.\n            await CoreSites.updateSiteInfoByUrl(this.siteUrl, this.username);\n\n            // Reset fields so the data is not in the view anymore.\n            this.credForm.controls['password'].reset();\n\n            // Go to the site initial page.\n            this.page\n                ? await CoreNavigator.navigateToSitePath(this.page, { params: this.pageOptions })\n                : await CoreNavigator.navigateToSiteHome();\n        } catch (error) {\n            CoreLoginHelper.treatUserTokenError(this.siteUrl, error, this.username, password);\n\n            if (error.loggedout) {\n                this.cancel();\n            } else if (error.errorcode == 'forcepasswordchangenotice') {\n                // Reset password field.\n                this.credForm.controls.password.reset();\n            }\n        } finally {\n            modal.dismiss();\n        }\n    }\n\n    /**\n     * Forgotten password button clicked.\n     */\n    forgottenPassword(): void {\n        CoreLoginHelper.forgottenPasswordClicked(this.siteUrl, this.username, this.siteConfig);\n    }\n\n    /**\n     * An OAuth button was clicked.\n     *\n     * @param provider The provider that was clicked.\n     */\n    oauthClicked(provider: CoreSiteIdentityProvider): void {\n        const result = CoreLoginHelper.openBrowserForOAuthLogin(\n            this.siteUrl,\n            provider,\n            this.siteConfig?.launchurl,\n            this.page,\n            this.pageOptions,\n        );\n\n        if (!result) {\n            CoreDomUtils.showErrorModal('Invalid data.');\n        }\n    }\n\n    /**\n     * Show instructions and scan QR code.\n     *\n     * @return Promise resolved when done.\n     */\n    async showInstructionsAndScanQR(): Promise<void> {\n        try {\n            await CoreLoginHelper.showScanQRInstructions();\n\n            await CoreLoginHelper.scanQR();\n        } catch {\n            // Ignore errors.\n        }\n    }\n\n    /**\n     * A11y key functionality that prevents keyDown events.\n     *\n     * @param e Event.\n     */\n    keyDown(e: KeyboardEvent): void {\n        if (e.key == 'Escape') {\n            e.preventDefault();\n            e.stopPropagation();\n        }\n    }\n\n    /**\n     * Cancel reconnect.\n     *\n     * @param e Event.\n     */\n    keyUp(e: KeyboardEvent): void {\n        if (e.key == 'Escape') {\n            this.cancel(e);\n        }\n    }\n\n}\n"],"sourceRoot":"webpack:///"}