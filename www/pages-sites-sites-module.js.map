{"version":3,"sources":["./src/core/features/login/pages/sites/sites.html","./src/core/features/login/pages/sites/sites.module.ts","./src/core/features/login/pages/sites/sites.ts"],"names":[],"mappings":"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","file":"pages-sites-sites-module.js","sourcesContent":["export default \"<ion-header>\\n    <ion-toolbar>\\n        <ion-buttons slot=\\\"start\\\">\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\n        </ion-buttons>\\n\\n        <h1>{{ 'core.settings.sites' | translate }}</h1>\\n\\n        <ion-buttons slot=\\\"end\\\">\\n            <ion-button fill=\\\"clear\\\" *ngIf=\\\"sites && sites.length > 0\\\" (click)=\\\"toggleDelete()\\\"\\n                [attr.aria-label]=\\\"'core.delete' | translate\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"fas-pen\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n            </ion-button>\\n            <ion-button (click)=\\\"openSettings()\\\" [attr.aria-label]=\\\"'core.settings.appsettings' | translate\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"fas-cog\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n            </ion-button>\\n        </ion-buttons>\\n    </ion-toolbar>\\n</ion-header>\\n<ion-content>\\n    <ion-list>\\n        <ion-item button (click)=\\\"login(site.id)\\\" *ngFor=\\\"let site of sites\\\" detail=\\\"true\\\">\\n            <ion-avatar slot=\\\"start\\\">\\n                <img [src]=\\\"site.avatar\\\" core-external-content [siteId]=\\\"site.id\\\"\\n                    alt=\\\"{{ 'core.pictureof' | translate:{$a: site.fullName} }}\\\" onError=\\\"this.src='assets/img/user-avatar.png'\\\">\\n            </ion-avatar>\\n            <ion-label>\\n                <p class=\\\"item-heading\\\">{{site.fullName}}</p>\\n                <p><core-format-text [text]=\\\"site.siteName\\\" clean=\\\"true\\\" [siteId]=\\\"site.id\\\"></core-format-text></p>\\n                <p>{{site.siteUrl}}</p>\\n            </ion-label>\\n            <ion-badge slot=\\\"end\\\" *ngIf=\\\"!showDelete && site.badge\\\">\\n                <span aria-hidden=\\\"true\\\">{{site.badge}}</span>\\n                <span class=\\\"sr-only\\\">{{ 'core.login.sitebadgedescription' | translate:{ count: site.badge } }}</span>\\n            </ion-badge>\\n            <ion-button *ngIf=\\\"showDelete\\\" slot=\\\"end\\\" fill=\\\"clear\\\" color=\\\"danger\\\" (click)=\\\"deleteSite($event, site)\\\"\\n                [attr.aria-label]=\\\"'core.delete' | translate\\\" [@coreSlideInOut]=\\\"'fromRight'\\\">\\n                <ion-icon name=\\\"fas-trash\\\" slot=\\\"icon-only\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n            </ion-button>\\n        </ion-item>\\n    </ion-list>\\n    <ion-fab slot=\\\"fixed\\\" core-fab vertical=\\\"bottom\\\" horizontal=\\\"end\\\">\\n        <ion-fab-button (click)=\\\"add()\\\" [attr.aria-label]=\\\"'core.add' | translate\\\">\\n            <ion-icon name=\\\"fas-plus\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n            <span class=\\\"sr-only\\\">{{ 'core.add' | translate }}</span>\\n        </ion-fab-button>\\n    </ion-fab>\\n</ion-content>\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { CoreSharedModule } from '@/core/shared.module';\nimport { CoreLoginSitesPage } from './sites';\n\nconst routes: Routes = [\n    {\n        path: '',\n        component: CoreLoginSitesPage,\n    },\n];\n\n@NgModule({\n    imports: [\n        RouterModule.forChild(routes),\n        CoreSharedModule,\n    ],\n    declarations: [\n        CoreLoginSitesPage,\n    ],\n    exports: [RouterModule],\n})\nexport class CoreLoginSitesPageModule {}\n","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUtils } from '@services/utils/utils';\nimport { Component, OnInit } from '@angular/core';\n\nimport { CoreSiteBasicInfo, CoreSites } from '@services/sites';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreLoginHelper } from '@features/login/services/login-helper';\nimport { CoreNavigator } from '@services/navigator';\nimport { CorePushNotifications } from '@features/pushnotifications/services/pushnotifications';\nimport { CoreFilter } from '@features/filter/services/filter';\nimport { CoreAnimations } from '@components/animations';\n\n/**\n * Page that displays a \"splash screen\" while the app is being initialized.\n */\n@Component({\n    selector: 'page-core-login-sites',\n    templateUrl: 'sites.html',\n    animations: [CoreAnimations.SLIDE_IN_OUT],\n})\nexport class CoreLoginSitesPage implements OnInit {\n\n    sites: CoreSiteBasicInfo[] = [];\n    showDelete = false;\n\n    protected logger: CoreLogger;\n\n    constructor() {\n        this.logger = CoreLogger.getInstance('CoreLoginSitesPage');\n    }\n\n    /**\n     * Component being initialized.\n     *\n     * @return Promise resolved when done.\n     */\n    async ngOnInit(): Promise<void> {\n        const sites = await CoreUtils.ignoreErrors(CoreSites.getSortedSites(), [] as CoreSiteBasicInfo[]);\n\n        // Remove protocol from the url to show more url text.\n        this.sites = await Promise.all(sites.map(async (site) => {\n            site.siteUrl = site.siteUrl.replace(/^https?:\\/\\//, '');\n            site.badge = await CoreUtils.ignoreErrors(CorePushNotifications.getSiteCounter(site.id)) || 0;\n\n            return site;\n        }));\n\n        this.showDelete = false;\n    }\n\n    /**\n     * Go to the page to add a site.\n     */\n    add(): void {\n        CoreLoginHelper.goToAddSite(false, true);\n    }\n\n    /**\n     * Delete a site.\n     *\n     * @param e Click event.\n     * @param site Site to delete.\n     * @return Promise resolved when done.\n     */\n    async deleteSite(e: Event, site: CoreSiteBasicInfo): Promise<void> {\n        e.stopPropagation();\n\n        let siteName = site.siteName || '';\n\n        siteName = await CoreFilter.formatText(siteName, { clean: true, singleLine: true, filter: false }, [], site.id);\n\n        try {\n            await CoreDomUtils.showDeleteConfirm('core.login.confirmdeletesite', { sitename: siteName });\n        } catch (error) {\n            // User cancelled, stop.\n            return;\n        }\n\n        try {\n            await CoreSites.deleteSite(site.id);\n\n            const index = this.sites.findIndex((listedSite) => listedSite.id == site.id);\n            index >= 0 && this.sites.splice(index, 1);\n            this.showDelete = false;\n\n            // If there are no sites left, go to add site.\n            const hasSites = await CoreSites.hasSites();\n\n            if (!hasSites) {\n                CoreLoginHelper.goToAddSite(true, true);\n            }\n        } catch (error) {\n            this.logger.error('Error deleting site ' + site.id, error);\n            CoreDomUtils.showErrorModalDefault(error, 'core.login.errordeletesite', true);\n        }\n    }\n\n    /**\n     * Login in a site.\n     *\n     * @param siteId The site ID.\n     * @return Promise resolved when done.\n     */\n    async login(siteId: string): Promise<void> {\n        const modal = await CoreDomUtils.showModalLoading();\n\n        try {\n            const loggedIn = await CoreSites.loadSite(siteId);\n\n            if (loggedIn) {\n                await CoreNavigator.navigateToSiteHome();\n\n                return;\n            }\n        } catch (error) {\n            this.logger.error('Error loading site ' + siteId, error);\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading site.');\n        } finally {\n            modal.dismiss();\n        }\n    }\n\n    /**\n     * Toggle delete.\n     */\n    toggleDelete(): void {\n        this.showDelete = !this.showDelete;\n    }\n\n    /**\n     * Open settings page.\n     */\n    openSettings(): void {\n        CoreNavigator.navigate('/settings');\n    }\n\n}\n"],"sourceRoot":"webpack:///"}