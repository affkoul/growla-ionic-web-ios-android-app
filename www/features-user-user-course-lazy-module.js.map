{"version":3,"sources":["./src/core/features/user/pages/participants/participants.html","./src/core/features/user/pages/participants/participants.page.ts","./src/core/features/user/user-course-lazy.module.ts"],"names":[],"mappings":"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","file":"features-user-user-course-lazy-module.js","sourcesContent":["export default \"<core-navbar-buttons slot=\\\"end\\\">\\n    <ion-button [hidden]=\\\"!searchEnabled\\\" (click)=\\\"toggleSearch()\\\" [attr.aria-label]=\\\"'core.search' | translate\\\">\\n        <ion-icon name=\\\"fas-search\\\" slot=\\\"icon-only\\\" aria-hidden=\\\"true\\\"></ion-icon>\\n    </ion-button>\\n</core-navbar-buttons>\\n\\n<ion-content>\\n    <core-split-view>\\n        <ion-refresher slot=\\\"fixed\\\" [disabled]=\\\"!participants.loaded || searchInProgress\\\"\\n            (ionRefresh)=\\\"refreshParticipants($event.target)\\\">\\n            <ion-refresher-content pullingText=\\\"{{ 'core.pulltorefresh' | translate }}\\\"></ion-refresher-content>\\n        </ion-refresher>\\n\\n        <core-search-box *ngIf=\\\"showSearchBox\\\"\\n            [disabled]=\\\"searchInProgress\\\" [spellcheck]=\\\"false\\\" [autoFocus]=\\\"true\\\" [lengthCheck]=\\\"1\\\"\\n            autocorrect=\\\"off\\\" searchArea=\\\"CoreUserParticipants\\\"\\n            (onSubmit)=\\\"search($event)\\\" (onClear)=\\\"clearSearch()\\\">\\n        </core-search-box>\\n\\n        <core-loading [hideUntil]=\\\"participants.loaded\\\">\\n            <core-empty-box *ngIf=\\\"participants.empty && !searchInProgress && !searchQuery\\\" icon=\\\"far-user\\\"\\n                [message]=\\\"'core.user.noparticipants' | translate\\\">\\n            </core-empty-box>\\n\\n            <core-empty-box *ngIf=\\\"participants.empty && !searchInProgress && searchQuery\\\" icon=\\\"fas-search\\\"\\n                [message]=\\\"'core.noresults' | translate\\\">\\n            </core-empty-box>\\n\\n            <ion-list *ngIf=\\\"!participants.empty\\\">\\n                <ion-item *ngFor=\\\"let participant of participants.items\\\"\\n                    class=\\\"ion-text-wrap\\\" [attr.aria-current]=\\\"participants.getItemAriaCurrent(participant)\\\"\\n                    [attr.aria-label]=\\\"participant.fullname\\\" (click)=\\\"participants.select(participant)\\\" button detail=\\\"true\\\">\\n\\n                    <core-user-avatar [user]=\\\"participant\\\" [linkProfile]=\\\"false\\\" [checkOnline]=\\\"true\\\" slot=\\\"start\\\">\\n                    </core-user-avatar>\\n\\n                    <ion-label>\\n                        <ng-container *ngIf=\\\"!searchQuery\\\">\\n                            <p class=\\\"item-heading\\\">{{ participant.fullname }}</p>\\n                            <p *ngIf=\\\"participant.lastcourseaccess\\\">\\n                                <strong>{{ 'core.lastaccess' | translate }}: </strong>\\n                                {{ participant.lastcourseaccess | coreTimeAgo }}\\n                            </p>\\n                            <p *ngIf=\\\"!participant.lastcourseaccess && participant.lastaccess\\\">\\n                                <strong>{{ 'core.lastaccess' | translate }}: </strong>\\n                                {{ participant.lastaccess | coreTimeAgo }}\\n                            </p>\\n                        </ng-container>\\n\\n                        <ng-container *ngIf=\\\"searchQuery\\\">\\n                            <p class=\\\"item-heading\\\">\\n                                <core-format-text [text]=\\\"participant.fullname\\\" [highlight]=\\\"searchQuery\\\" [filter]=\\\"false\\\">\\n                                </core-format-text>\\n                            </p>\\n                        </ng-container>\\n                    </ion-label>\\n\\n                </ion-item>\\n            </ion-list>\\n            <core-infinite-loading [enabled]=\\\"participants.loaded && !participants.completed\\\"\\n                (action)=\\\"fetchMoreParticipants($event)\\\" [error]=\\\"fetchMoreParticipantsFailed\\\">\\n            </core-infinite-loading>\\n        </core-loading>\\n    </core-split-view>\\n</ion-content>\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { AfterViewInit, Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { IonRefresher } from '@ionic/angular';\n\nimport { CoreApp } from '@services/app';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreNavigator } from '@services/navigator';\nimport { CorePageItemsListManager } from '@classes/page-items-list-manager';\nimport { CoreScreen } from '@services/screen';\nimport { CoreSplitViewComponent } from '@components/split-view/split-view';\nimport { CoreUser, CoreUserProvider, CoreUserParticipant, CoreUserData } from '@features/user/services/user';\nimport { CoreUtils } from '@services/utils/utils';\n\n/**\n * Page that displays the list of course participants.\n */\n@Component({\n    selector: 'page-core-user-participants',\n    templateUrl: 'participants.html',\n})\nexport class CoreUserParticipantsPage implements OnInit, AfterViewInit, OnDestroy {\n\n    participants: CoreUserParticipantsManager;\n    searchQuery: string | null = null;\n    searchInProgress = false;\n    searchEnabled = false;\n    showSearchBox = false;\n    fetchMoreParticipantsFailed = false;\n\n    @ViewChild(CoreSplitViewComponent) splitView!: CoreSplitViewComponent;\n\n    constructor() {\n        const courseId = CoreNavigator.getRouteNumberParam('courseId')!;\n\n        this.participants = new CoreUserParticipantsManager(CoreUserParticipantsPage, courseId);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async ngOnInit(): Promise<void> {\n        this.searchEnabled = await CoreUser.canSearchParticipantsInSite();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async ngAfterViewInit(): Promise<void> {\n        await this.fetchInitialParticipants();\n\n        this.participants.start(this.splitView);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        this.participants.destroy();\n    }\n\n    /**\n     * Show or hide search box.\n     */\n    toggleSearch(): void {\n        this.showSearchBox = !this.showSearchBox;\n\n        if (this.showSearchBox) {\n            // Make search bar visible.\n            this.splitView.menuContent.scrollToTop();\n        } else {\n            this.clearSearch();\n        }\n    }\n\n    /**\n     * Clear search.\n     */\n    async clearSearch(): Promise<void> {\n        if (this.searchQuery === null) {\n            // Nothing to clear.\n            return;\n        }\n\n        this.searchQuery = null;\n        this.searchInProgress = false;\n        this.participants.resetItems();\n\n        await this.fetchInitialParticipants();\n    }\n\n    /**\n     * Start a new search.\n     *\n     * @param query Text to search for.\n     */\n    async search(query: string): Promise<void> {\n        CoreApp.closeKeyboard();\n\n        this.searchInProgress = true;\n        this.searchQuery = query;\n        this.participants.resetItems();\n\n        await this.fetchInitialParticipants();\n\n        this.searchInProgress = false;\n    }\n\n    /**\n     * Refresh participants.\n     *\n     * @param refresher Refresher.\n     */\n    async refreshParticipants(refresher: IonRefresher): Promise<void> {\n        await CoreUtils.ignoreErrors(CoreUser.invalidateParticipantsList(this.participants.courseId));\n        await CoreUtils.ignoreErrors(this.fetchParticipants());\n\n        refresher?.complete();\n    }\n\n    /**\n     * Load a new batch of participants.\n     *\n     * @param complete Completion callback.\n     */\n    async fetchMoreParticipants(complete: () => void): Promise<void> {\n        try {\n            await this.fetchParticipants(this.participants.items);\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading more participants');\n\n            this.fetchMoreParticipantsFailed = true;\n        }\n\n        complete();\n    }\n\n    /**\n     * Obtain the initial batch of participants.\n     */\n    private async fetchInitialParticipants(): Promise<void> {\n        try {\n            await this.fetchParticipants();\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading participants');\n\n            this.participants.setItems([]);\n        }\n    }\n\n    /**\n     * Update the list of participants.\n     *\n     * @param loadedParticipants Participants list to continue loading from.\n     */\n    private async fetchParticipants(loadedParticipants: CoreUserParticipant[] | CoreUserData[] = []): Promise<void> {\n        if (this.searchQuery) {\n            const { participants, canLoadMore } = await CoreUser.searchParticipants(\n                this.participants.courseId,\n                this.searchQuery,\n                true,\n                Math.ceil(loadedParticipants.length / CoreUserProvider.PARTICIPANTS_LIST_LIMIT),\n                CoreUserProvider.PARTICIPANTS_LIST_LIMIT,\n            );\n\n            this.participants.setItems((loadedParticipants as CoreUserData[]).concat(participants), canLoadMore);\n        } else {\n            const { participants, canLoadMore } = await CoreUser.getParticipants(\n                this.participants.courseId,\n                loadedParticipants.length,\n            );\n\n            this.participants.setItems((loadedParticipants as CoreUserParticipant[]).concat(participants), canLoadMore);\n        }\n\n        this.fetchMoreParticipantsFailed = false;\n    }\n\n}\n\n/**\n * Helper to manage the list of participants.\n */\nclass CoreUserParticipantsManager extends CorePageItemsListManager<CoreUserParticipant | CoreUserData> {\n\n    courseId: number;\n\n    constructor(pageComponent: unknown, courseId: number) {\n        super(pageComponent);\n\n        this.courseId = courseId;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async select(participant: CoreUserParticipant | CoreUserData): Promise<void> {\n        if (CoreScreen.isMobile) {\n            await CoreNavigator.navigateToSitePath(\n                '/user/profile',\n                { params: { userId: participant.id, courseId: this.courseId } },\n            );\n\n            return;\n        }\n\n        return super.select(participant);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected getItemPath(participant: CoreUserParticipant | CoreUserData): string {\n        return participant.id.toString();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected async logActivity(): Promise<void> {\n        await CoreUser.logParticipantsView(this.courseId);\n    }\n\n}\n","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { CoreSharedModule } from '@/core/shared.module';\nimport { CoreSearchComponentsModule } from '@features/search/components/components.module';\n\nimport { CoreUserParticipantsPage } from './pages/participants/participants.page';\n\nconst routes: Routes = [\n    {\n        path: '',\n        component: CoreUserParticipantsPage,\n        children: [\n            {\n                path: ':userId',\n                loadChildren: () => import('@features/user/pages/profile/profile.module').then(m => m.CoreUserProfilePageModule),\n            },\n        ],\n    },\n];\n\n@NgModule({\n    imports: [\n        RouterModule.forChild(routes),\n        CoreSharedModule,\n        CoreSearchComponentsModule,\n    ],\n    declarations: [\n        CoreUserParticipantsPage,\n    ],\n})\nexport class CoreUserCourseLazyModule {}\n"],"sourceRoot":"webpack:///"}